USE32
ALIGN 4
HASH.CRC32:
; in:
;   ESI = data to hash (AsciiZ)
; out:
;   EAX = CRC32
	PUSH ESI EDI ECX EBX EDX
	CLD
	XOR		ECX, ECX
	DEC		ECX
	MOV		EDX, ECX
.NextByteCRC:
	XOR		EAX, EAX
	XOR		EBX, EBX
	LODSB
	OR		AL, AL
	JZ		SHORT .ECRC
	XOR		AL, CL
	MOV		CL, CH
	MOV		CH, DL
	MOV		DL, DH
	MOV		DH, 08
.NextBitCRC:
	SHR		BX, 1
	RCR		AX, 1
	JNC		SHORT .NoCRC
	XOR		AX, 0x8320
	XOR		BX, 0xEDB8
.NoCRC:
	DEC		DH
	JNZ		SHORT .NextBitCRC
	XOR		ECX, EAX
	XOR		EDX, EBX
	JMP		SHORT .NextByteCRC
.ECRC:
	NOT		EDX
	NOT		ECX
	MOV		EAX, EDX
	ROL		EAX, 16
	MOV		AX,  CX
.EXIT:
	POP EDX EBX ECX EDI ESI
RET


